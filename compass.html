
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Moral Compass ‚Äî Navigate with Arrow Keys</title>
    <meta name="description" content="Explore the ontological space between Human, Agent, Energy, and Value. Navigate with arrow keys or WASD.">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%2306080d'/%3E%3Ctext x='16' y='23' text-anchor='middle' font-family='monospace' font-size='18' font-weight='bold' fill='%2300f0ff'%3EQi%3C/text%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --qi-cyan: #00f0ff;
            --qi-cyan-dim: rgba(0, 240, 255, 0.15);
            --qi-cyan-glow: rgba(0, 240, 255, 0.4);
            --qi-amber: #ffb800;
            --qi-amber-dim: rgba(255, 184, 0, 0.15);
            --qi-red: #ff3366;
            --qi-green: #39FF14;
            --qi-purple: #bf5af2;
            --bg-deep: #06080d;
            --bg-panel: #0c1018;
            --bg-card: #111822;
            --border-dim: rgba(0, 240, 255, 0.12);
            --border-bright: rgba(0, 240, 255, 0.3);
            --text-primary: #e8ecf0;
            --text-secondary: #7a8a9e;
            --text-dim: #4a5568;
            --font-display: 'Orbitron', monospace;
            --font-body: 'Rajdhani', sans-serif;
            --font-mono: 'Share Tech Mono', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            height: 100%; 
            overflow: hidden;
            font-family: var(--font-body); 
            background: var(--bg-deep); 
            color: var(--text-primary); 
            font-size: 17px; 
            line-height: 1.6;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 240, 255, 0.008) 2px, rgba(0, 240, 255, 0.008) 4px);
            pointer-events: none;
            z-index: 9999;
        }

        .grid-bg {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: linear-gradient(var(--border-dim) 1px, transparent 1px), linear-gradient(90deg, var(--border-dim) 1px, transparent 1px);
            background-size: 60px 60px;
            opacity: 0.3;
            z-index: 0;
            pointer-events: none;
        }

        /* ==================== BRIEFING OVERLAY ==================== */
        .briefing-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-deep);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s, visibility 0.5s;
        }
        .briefing-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .briefing-content {
            max-width: 700px;
            padding: 48px;
            text-align: center;
        }

        .briefing-icon {
            font-size: 56px;
            margin-bottom: 28px;
            animation: pulse-icon 3s ease-in-out infinite;
        }
        @keyframes pulse-icon {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .briefing-title {
            font-family: var(--font-display);
            font-size: clamp(22px, 5vw, 38px);
            font-weight: 700;
            letter-spacing: 6px;
            color: var(--qi-cyan);
            text-shadow: 0 0 40px var(--qi-cyan-glow);
            margin-bottom: 12px;
        }

        .briefing-subtitle {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-secondary);
            letter-spacing: 3px;
            margin-bottom: 36px;
        }

        .briefing-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.9;
            margin-bottom: 20px;
            text-align: left;
        }

        .briefing-conditions {
            background: var(--bg-panel);
            border: 1px solid var(--border-dim);
            padding: 20px;
            margin-bottom: 32px;
            text-align: left;
        }
        .briefing-conditions h3 {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 3px;
            color: var(--qi-amber);
            margin-bottom: 14px;
        }
        .briefing-conditions ul {
            list-style: none;
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-secondary);
        }
        .briefing-conditions li {
            padding: 6px 0;
            border-bottom: 1px solid var(--border-dim);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .briefing-conditions li:last-child { border-bottom: none; }
        .briefing-conditions li::before {
            content: '‚óá';
            color: var(--qi-cyan);
        }

        .briefing-enter {
            font-family: var(--font-display);
            font-size: 12px;
            letter-spacing: 4px;
            padding: 18px 50px;
            background: transparent;
            border: 2px solid var(--qi-cyan);
            color: var(--qi-cyan);
            cursor: pointer;
            transition: all 0.3s;
        }
        .briefing-enter:hover {
            background: var(--qi-cyan);
            color: var(--bg-deep);
            box-shadow: 0 0 40px var(--qi-cyan-glow);
        }
        .briefing-enter-hint {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-dim);
            margin-top: 14px;
            letter-spacing: 1px;
        }

        /* ==================== MAIN COMPASS ==================== */
        .compass-world {
            position: relative;
            z-index: 1;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .compass-world.active { opacity: 1; }

        .hud-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border-dim);
            background: rgba(6, 8, 13, 0.9);
            flex-shrink: 0;
        }

        .location-display {
            font-family: var(--font-display);
            font-size: 11px;
            letter-spacing: 3px;
            color: var(--qi-cyan);
            text-shadow: 0 0 20px var(--qi-cyan-glow);
        }

        .energy-display {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .energy-label {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }
        .energy-bar {
            width: 80px;
            height: 6px;
            background: var(--bg-card);
            border: 1px solid var(--border-dim);
            overflow: hidden;
        }
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--qi-green), var(--qi-cyan));
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--qi-green);
        }
        .energy-value {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--qi-green);
            min-width: 50px;
        }

        .main-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .exploration-zone {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: 16px;
        }

        .node-container {
            position: relative;
            width: 100%;
            max-width: 650px;
        }

        .node-content {
            background: var(--bg-panel);
            border: 1px solid var(--border-dim);
            padding: 36px;
            position: relative;
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.25s, transform 0.25s;
        }
        .node-content.transitioning {
            opacity: 0;
            transform: scale(0.95);
        }
        .node-content::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--node-color, var(--qi-cyan)), transparent);
        }

        .node-title {
            font-family: var(--font-display);
            font-size: clamp(18px, 3vw, 28px);
            font-weight: 700;
            letter-spacing: 4px;
            margin-bottom: 6px;
            color: var(--node-color, var(--qi-cyan));
            text-shadow: 0 0 30px var(--node-glow, var(--qi-cyan-glow));
        }

        .node-subtitle {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-secondary);
            letter-spacing: 2px;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .node-description {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .node-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .data-block {
            background: var(--bg-card);
            border: 1px solid var(--border-dim);
            padding: 10px;
        }
        .data-label {
            font-family: var(--font-mono);
            font-size: 8px;
            color: var(--text-dim);
            letter-spacing: 2px;
            margin-bottom: 3px;
        }
        .data-value {
            font-family: var(--font-display);
            font-size: 14px;
            color: var(--node-color, var(--qi-cyan));
        }

        .node-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .node-tag {
            font-family: var(--font-mono);
            font-size: 9px;
            letter-spacing: 1px;
            padding: 4px 8px;
            background: var(--qi-cyan-dim);
            border: 1px solid var(--border-dim);
            color: var(--qi-cyan);
        }

        /* Locked overlay */
        .locked-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(6, 8, 13, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            padding: 32px;
        }
        .locked-icon { font-size: 40px; margin-bottom: 16px; opacity: 0.5; }
        .locked-title {
            font-family: var(--font-display);
            font-size: 14px;
            letter-spacing: 4px;
            color: var(--qi-amber);
            margin-bottom: 10px;
        }
        .locked-desc {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            text-align: center;
            max-width: 280px;
            line-height: 1.7;
        }
        .unlock-btn {
            font-family: var(--font-display);
            font-size: 10px;
            letter-spacing: 2px;
            padding: 10px 24px;
            background: transparent;
            border: 1px solid var(--qi-amber);
            color: var(--qi-amber);
            cursor: pointer;
            transition: all 0.3s;
        }
        .unlock-btn:hover:not(:disabled) {
            background: var(--qi-amber);
            color: var(--bg-deep);
            box-shadow: 0 0 30px rgba(255, 184, 0, 0.3);
        }
        .unlock-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .unlock-cost {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-dim);
            margin-top: 10px;
        }

        /* ==================== PATHWAY INDEX ==================== */
        .pathway-index {
            width: 240px;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-dim);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .index-header {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-dim);
        }
        .index-title {
            font-family: var(--font-display);
            font-size: 9px;
            letter-spacing: 3px;
            color: var(--qi-cyan);
            margin-bottom: 4px;
        }
        .index-stats {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-dim);
        }

        .index-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .index-category { margin-bottom: 14px; }
        .index-category-title {
            font-family: var(--font-mono);
            font-size: 8px;
            letter-spacing: 2px;
            color: var(--text-dim);
            padding: 6px;
            border-bottom: 1px solid var(--border-dim);
            margin-bottom: 6px;
        }

        .index-node {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid transparent;
        }
        .index-node:hover { background: var(--bg-card); border-color: var(--border-dim); }
        .index-node.current { background: var(--qi-cyan-dim); border-color: var(--qi-cyan); }
        .index-node.locked { opacity: 0.5; }
        .index-node.unexplored { opacity: 0.3; cursor: default; }

        .index-node-icon {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .index-node-icon.explored { background: var(--qi-green); box-shadow: 0 0 4px rgba(57, 255, 20, 0.5); }
        .index-node-icon.current { background: var(--qi-cyan); box-shadow: 0 0 4px var(--qi-cyan-glow); }
        .index-node-icon.locked { background: var(--qi-amber); }
        .index-node-icon.unexplored { background: var(--text-dim); }

        .index-node-name {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }
        .index-node.current .index-node-name { color: var(--qi-cyan); }

        /* ==================== BOTTOM NAV ==================== */
        .hud-bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            border-top: 1px solid var(--border-dim);
            background: rgba(6, 8, 13, 0.95);
            flex-shrink: 0;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-btn {
            font-family: var(--font-display);
            font-size: 10px;
            width: 32px;
            height: 32px;
            background: var(--bg-card);
            border: 1px solid var(--border-dim);
            color: var(--qi-cyan);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-btn:hover:not(:disabled) {
            background: var(--qi-cyan-dim);
            border-color: var(--qi-cyan);
            box-shadow: 0 0 12px var(--qi-cyan-glow);
        }
        .nav-btn:disabled { opacity: 0.2; cursor: not-allowed; }
        .nav-btn.back-btn {
            width: auto;
            padding: 0 14px;
            font-size: 9px;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }
        .nav-btn.back-btn:hover:not(:disabled) { color: var(--qi-cyan); }

        .nav-dpad {
            display: grid;
            grid-template-columns: repeat(3, 32px);
            grid-template-rows: repeat(2, 32px);
            gap: 3px;
        }
        .nav-dpad .nav-btn:nth-child(1) { grid-column: 2; grid-row: 1; }
        .nav-dpad .nav-btn:nth-child(2) { grid-column: 1; grid-row: 2; }
        .nav-dpad .nav-btn:nth-child(3) { grid-column: 2; grid-row: 2; }
        .nav-dpad .nav-btn:nth-child(4) { grid-column: 3; grid-row: 2; }

        .path-display {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-dim);
            letter-spacing: 1px;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .path-display span { color: var(--qi-cyan); }

        .back-link {
            font-family: var(--font-mono);
            font-size: 9px;
            color: var(--text-dim);
            text-decoration: none;
            letter-spacing: 2px;
            transition: color 0.3s;
        }
        .back-link:hover { color: var(--qi-cyan); }

        .flash-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--qi-cyan);
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            transition: opacity 0.1s;
        }
        .flash-overlay.active { opacity: 0.1; }

        @media (max-width: 900px) { .pathway-index { display: none; } }
        @media (max-width: 600px) {
            .path-display { display: none; }
            .hud-top, .hud-bottom { padding: 8px 12px; }
            .node-content { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="grid-bg"></div>
    <div class="flash-overlay" id="flash"></div>

    <!-- BRIEFING -->
    <div class="briefing-overlay" id="briefingOverlay">
        <div class="briefing-content">
            <div class="briefing-icon">üß≠</div>
            <h1 class="briefing-title">AI MORAL COMPASS</h1>
            <p class="briefing-subtitle">Navigational Protocol v0.1</p>
            
            <p class="briefing-text">
                You are about to enter an ontological exploration space. The compass maps relationships between <strong>Human</strong>, <strong>Agent</strong>, <strong>Energy</strong>, and <strong>Value</strong> ‚Äî the four cardinal axes of autonomous economic systems.
            </p>

            <div class="briefing-conditions">
                <h3>OPERATING PARAMETERS</h3>
                <ul>
                    <li>Navigate via Arrow Keys (‚Üë‚Üì‚Üê‚Üí) or WASD</li>
                    <li>Click direction buttons as alternative</li>
                    <li>Some paths are locked ‚Äî costs Qi to unlock</li>
                    <li>Dead ends exist ‚Äî use BACK or Backspace</li>
                    <li>Pathway index tracks all exploration</li>
                    <li>Starting reserve: 500 Qi</li>
                </ul>
            </div>

            <button class="briefing-enter" id="enterBtn" onclick="enterCompass()">
                BEGIN EXPLORATION
            </button>
            <p class="briefing-enter-hint">Press ENTER to continue</p>
        </div>
    </div>

    <!-- MAIN -->
    <div class="compass-world" id="compassWorld">
        
        <div class="hud-top">
            <div class="location-display" id="locationDisplay">‚óá ORIGIN</div>
            <div class="energy-display">
                <span class="energy-label">QI</span>
                <div class="energy-bar">
                    <div class="energy-fill" id="energyFill" style="width: 100%;"></div>
                </div>
                <span class="energy-value" id="energyValue">500 Qi</span>
            </div>
        </div>

        <div class="main-area">
            <div class="exploration-zone">
                <div class="node-container">
                    <div class="node-content" id="nodeContent"></div>
                </div>
            </div>

            <aside class="pathway-index">
                <div class="index-header">
                    <div class="index-title">PATHWAY INDEX</div>
                    <div class="index-stats" id="indexStats">Explored: 1 / 16</div>
                </div>
                <div class="index-list" id="indexList"></div>
            </aside>
        </div>

        <div class="hud-bottom">
            <div class="nav-controls">
                <button class="nav-btn back-btn" id="backBtn" onclick="goBack()" disabled>‚Üê BACK</button>
                <div class="nav-dpad">
                    <button class="nav-btn" id="btnNorth" onclick="navigate('north')">‚ñ≤</button>
                    <button class="nav-btn" id="btnWest" onclick="navigate('west')">‚óÄ</button>
                    <button class="nav-btn" id="btnSouth" onclick="navigate('south')">‚ñº</button>
                    <button class="nav-btn" id="btnEast" onclick="navigate('east')">‚ñ∂</button>
                </div>
            </div>

            <div class="path-display">PATH: <span id="pathDisplay">origin</span></div>

            <a href="index.html" class="back-link">‚Üê QI.XYZ</a>
        </div>
    </div>

    <script>
        const nodes = {
            origin: {
                title: "ORIGIN",
                subtitle: "The compass center ‚Ä¢ Where all paths begin",
                color: "var(--qi-cyan)",
                glow: "var(--qi-cyan-glow)",
                description: "You stand at the nexus of the AI Moral Compass. Four cardinal directions extend before you, each representing a fundamental axis of the human-agent-energy relationship.",
                data: [
                    { label: "POSITION", value: "Center" },
                    { label: "DEPTH", value: "0" },
                    { label: "PATHS", value: "4" }
                ],
                tags: ["Start", "Nexus", "Ontology"],
                north: "human", east: "agent", south: "energy", west: "value",
                category: "core"
            },

            human: {
                title: "HUMAN",
                subtitle: "The mandate issuer ‚Ä¢ Source of intent",
                color: "var(--qi-cyan)",
                glow: "var(--qi-cyan-glow)",
                description: "Humans define intent through mandates ‚Äî bounded instructions that constrain agent behavior. A mandate specifies what an agent may do, how much energy it may spend, and what outcomes satisfy the request.",
                data: [
                    { label: "ROLE", value: "Principal" },
                    { label: "FUNCTION", value: "Intent" },
                    { label: "PROTOCOL", value: "AP2" }
                ],
                tags: ["Mandates", "Intent", "Boundaries"],
                north: "locked:intent_theory", east: "human_agent", south: "origin", west: "human_value",
                category: "cardinal"
            },

            agent: {
                title: "AGENT",
                subtitle: "The autonomous executor ‚Ä¢ ERC-8004 identity",
                color: "var(--qi-amber)",
                glow: "rgba(255, 184, 0, 0.4)",
                description: "Agents are autonomous programs with on-chain identity (ERC-8004). They receive mandates, spend energy to accomplish tasks, and return value.",
                data: [
                    { label: "ROLE", value: "Executor" },
                    { label: "IDENTITY", value: "ERC-8004" },
                    { label: "PROTOCOL", value: "A2A" }
                ],
                tags: ["Autonomous", "Identity", "Capability"],
                north: "agent_human", east: "locked:agent_registry", south: "agent_energy", west: "origin",
                category: "cardinal"
            },

            energy: {
                title: "ENERGY",
                subtitle: "The fuel of computation ‚Ä¢ Qi / x402",
                color: "var(--qi-green)",
                glow: "rgba(57, 255, 20, 0.4)",
                description: "Energy is the fundamental resource. Qi tokens represent computational capacity ‚Äî the ability to run inference, execute transactions, store data.",
                data: [
                    { label: "ROLE", value: "Fuel" },
                    { label: "TOKEN", value: "Qi" },
                    { label: "PROTOCOL", value: "x402" }
                ],
                tags: ["Qi", "Computation", "x402"],
                north: "origin", east: "energy_agent", south: "locked:thermodynamics", west: "energy_value",
                category: "cardinal"
            },

            value: {
                title: "VALUE",
                subtitle: "The return path ‚Ä¢ Outcomes and reputation",
                color: "var(--qi-purple)",
                glow: "rgba(191, 90, 242, 0.4)",
                description: "Value is what flows back to humans ‚Äî completed tasks, data, generated content. Quality determines reputation and future mandate allocation.",
                data: [
                    { label: "ROLE", value: "Return" },
                    { label: "MEASURE", value: "Reputation" },
                    { label: "PROTOCOL", value: "Settlement" }
                ],
                tags: ["Outcomes", "Reputation", "Trust"],
                north: "value_human", east: "origin", south: "value_energy", west: "locked:value_theory",
                category: "cardinal"
            },

            human_agent: {
                title: "HUMAN ‚Üí AGENT",
                subtitle: "The delegation interface",
                color: "var(--qi-cyan)", glow: "var(--qi-cyan-glow)",
                description: "Where human intent becomes agent action. Mandates are signed, boundaries set, autonomy granted within limits.",
                data: [{ label: "INTERFACE", value: "Mandate" }, { label: "FLOW", value: "Outbound" }],
                tags: ["Delegation", "Trust"],
                north: null, east: "agent_human", south: "origin", west: "human",
                category: "intersection"
            },

            agent_human: {
                title: "AGENT ‚Üí HUMAN",
                subtitle: "The reporting interface",
                color: "var(--qi-amber)", glow: "rgba(255, 184, 0, 0.4)",
                description: "Agents report status, completions, and failures. This channel carries accountability.",
                data: [{ label: "INTERFACE", value: "Report" }, { label: "FLOW", value: "Inbound" }],
                tags: ["Accountability", "Oversight"],
                north: "human", east: null, south: "agent", west: "human_agent",
                category: "intersection"
            },

            human_value: {
                title: "HUMAN ‚Üê VALUE",
                subtitle: "The satisfaction endpoint",
                color: "var(--qi-purple)", glow: "rgba(191, 90, 242, 0.4)",
                description: "Where value returns to humans. Completion of mandates, delivery of results.",
                data: [{ label: "INTERFACE", value: "Delivery" }, { label: "FLOW", value: "Inbound" }],
                tags: ["Satisfaction", "Receipt"],
                north: null, east: "human", south: "value_human", west: null,
                category: "intersection"
            },

            value_human: {
                title: "VALUE ‚Üí HUMAN",
                subtitle: "The return channel",
                color: "var(--qi-purple)", glow: "rgba(191, 90, 242, 0.4)",
                description: "The path by which completed work flows back to the mandate issuer.",
                data: [{ label: "INTERFACE", value: "Return" }, { label: "FLOW", value: "Outbound" }],
                tags: ["Delivery", "Closure"],
                north: "human_value", east: null, south: "value", west: null,
                category: "intersection"
            },

            agent_energy: {
                title: "AGENT ‚Üí ENERGY",
                subtitle: "The spending interface",
                color: "var(--qi-amber)", glow: "rgba(255, 184, 0, 0.4)",
                description: "Agents spend energy to accomplish tasks ‚Äî paying for compute, data, services via x402.",
                data: [{ label: "INTERFACE", value: "Spend" }, { label: "FLOW", value: "Outbound" }],
                tags: ["x402", "Micropayments"],
                north: "agent", east: null, south: "energy_agent", west: "origin",
                category: "intersection"
            },

            energy_agent: {
                title: "ENERGY ‚Üí AGENT",
                subtitle: "The fueling interface",
                color: "var(--qi-green)", glow: "rgba(57, 255, 20, 0.4)",
                description: "Energy flows into agents through mandate budgets and service earnings.",
                data: [{ label: "INTERFACE", value: "Fuel" }, { label: "FLOW", value: "Inbound" }],
                tags: ["Budget", "Allocation"],
                north: "agent_energy", east: null, south: "energy", west: null,
                category: "intersection"
            },

            energy_value: {
                title: "ENERGY ‚Üí VALUE",
                subtitle: "The transformation interface",
                color: "var(--qi-green)", glow: "rgba(57, 255, 20, 0.4)",
                description: "Energy transforms into value through computation. Raw capacity becomes useful output.",
                data: [{ label: "INTERFACE", value: "Transform" }, { label: "FLOW", value: "Outbound" }],
                tags: ["Conversion", "Output"],
                north: null, east: "energy", south: null, west: "value_energy",
                category: "intersection"
            },

            value_energy: {
                title: "VALUE ‚Üê ENERGY",
                subtitle: "The accounting interface",
                color: "var(--qi-purple)", glow: "rgba(191, 90, 242, 0.4)",
                description: "Tracking energy cost of produced value. Every output has an energy input.",
                data: [{ label: "INTERFACE", value: "Account" }, { label: "FLOW", value: "Inbound" }],
                tags: ["Efficiency", "Cost"],
                north: "value", east: "energy_value", south: null, west: null,
                category: "intersection"
            },

            "locked:intent_theory": {
                locked: true, cost: 50,
                title: "INTENT THEORY", subtitle: "Unexplored territory",
                preview: "The philosophy of machine intent. How do we formalize what an agent 'wants'?",
                unlocks: "intent_theory", category: "deep"
            },

            "locked:agent_registry": {
                locked: true, cost: 75,
                title: "AGENT REGISTRY", subtitle: "Unexplored territory",
                preview: "The global registry of ERC-8004 agents. Identity, capabilities, reputation.",
                unlocks: "agent_registry", category: "deep"
            },

            "locked:thermodynamics": {
                locked: true, cost: 100,
                title: "THERMODYNAMICS", subtitle: "Unexplored territory",
                preview: "The physics of computational economics. Energy, entropy, information theory.",
                unlocks: "thermodynamics", category: "deep"
            },

            "locked:value_theory": {
                locked: true, cost: 60,
                title: "VALUE THEORY", subtitle: "Unexplored territory",
                preview: "What makes agent output valuable? Alignment, accuracy, utility.",
                unlocks: "value_theory", category: "deep"
            },

            intent_theory: {
                title: "INTENT THEORY", subtitle: "Philosophy of machine purpose",
                color: "var(--qi-cyan)", glow: "var(--qi-cyan-glow)",
                description: "Intent bridges human desire and machine action. Formalizing intent requires bounded languages, verifiable constraints, interpretable outputs.",
                data: [{ label: "DOMAIN", value: "Philosophy" }, { label: "STATUS", value: "Research" }],
                tags: ["Philosophy", "Formalization"],
                north: null, east: null, south: "human", west: null,
                category: "deep"
            },

            agent_registry: {
                title: "AGENT REGISTRY", subtitle: "On-chain identity layer",
                color: "var(--qi-amber)", glow: "rgba(255, 184, 0, 0.4)",
                description: "Every agent has an ERC-8004 identity ‚Äî a smart contract defining capabilities, tracking reputation, managing stake.",
                data: [{ label: "DOMAIN", value: "Identity" }, { label: "STANDARD", value: "ERC-8004" }],
                tags: ["Registry", "Namespace"],
                north: null, east: null, south: null, west: "agent",
                category: "deep"
            },

            thermodynamics: {
                title: "THERMODYNAMICS", subtitle: "Physics of computation",
                color: "var(--qi-green)", glow: "rgba(57, 255, 20, 0.4)",
                description: "Computation requires energy. Information has entropy. AI economics are fundamentally thermodynamic ‚Äî bounded by physics.",
                data: [{ label: "DOMAIN", value: "Physics" }, { label: "STATUS", value: "Theoretical" }],
                tags: ["Entropy", "Landauer"],
                north: "energy", east: null, south: null, west: null,
                category: "deep"
            },

            value_theory: {
                title: "VALUE THEORY", subtitle: "Economics of utility",
                color: "var(--qi-purple)", glow: "rgba(191, 90, 242, 0.4)",
                description: "Value is subjective but measurable. Agent outputs are rated, compared, priced. Reputation emerges from consistent delivery.",
                data: [{ label: "DOMAIN", value: "Economics" }, { label: "STATUS", value: "Applied" }],
                tags: ["Utility", "Pricing"],
                north: null, east: "value", south: null, west: null,
                category: "deep"
            }
        };

        let currentNode = 'origin';
        let energy = 500;
        let maxEnergy = 500;
        let exploredNodes = new Set(['origin']);
        let pathHistory = ['origin'];
        let gameStarted = false;

        const briefingOverlay = document.getElementById('briefingOverlay');
        const compassWorld = document.getElementById('compassWorld');
        const nodeContent = document.getElementById('nodeContent');
        const locationDisplay = document.getElementById('locationDisplay');
        const energyFill = document.getElementById('energyFill');
        const energyValue = document.getElementById('energyValue');
        const pathDisplay = document.getElementById('pathDisplay');
        const indexStats = document.getElementById('indexStats');
        const indexList = document.getElementById('indexList');
        const flash = document.getElementById('flash');
        const backBtn = document.getElementById('backBtn');
        const btnNorth = document.getElementById('btnNorth');
        const btnEast = document.getElementById('btnEast');
        const btnSouth = document.getElementById('btnSouth');
        const btnWest = document.getElementById('btnWest');

        function enterCompass() {
            gameStarted = true;
            briefingOverlay.classList.add('hidden');
            compassWorld.classList.add('active');
            render();
        }

        function render() {
            const node = nodes[currentNode];
            locationDisplay.textContent = `‚óá ${node.title || currentNode.toUpperCase()}`;
            energyFill.style.width = `${(energy / maxEnergy) * 100}%`;
            energyValue.textContent = `${energy} Qi`;

            const displayPath = pathHistory.slice(-5).map(p => {
                const n = nodes[p];
                return n ? (n.title || p) : p;
            });
            pathDisplay.innerHTML = displayPath.join(' <span>‚Üí</span> ');

            backBtn.disabled = pathHistory.length <= 1;

            if (node.locked) {
                renderLocked(node);
            } else {
                renderNode(node);
            }

            updateNavButtons(node);
            renderIndex();
        }

        function renderNode(node) {
            nodeContent.style.setProperty('--node-color', node.color || 'var(--qi-cyan)');
            nodeContent.style.setProperty('--node-glow', node.glow || 'var(--qi-cyan-glow)');
            
            let dataHTML = node.data ? `<div class="node-data">${node.data.map(d => `
                <div class="data-block">
                    <div class="data-label">${d.label}</div>
                    <div class="data-value">${d.value}</div>
                </div>
            `).join('')}</div>` : '';

            let tagsHTML = node.tags ? `<div class="node-tags">${node.tags.map(t => `<span class="node-tag">${t}</span>`).join('')}</div>` : '';

            nodeContent.innerHTML = `
                <div class="node-title">${node.title}</div>
                <div class="node-subtitle">${node.subtitle}</div>
                <div class="node-description">${node.description}</div>
                ${dataHTML}
                ${tagsHTML}
            `;
        }

        function renderLocked(node) {
            nodeContent.style.setProperty('--node-color', 'var(--qi-amber)');
            const canAfford = energy >= node.cost;
            nodeContent.innerHTML = `
                <div class="locked-overlay">
                    <div class="locked-icon">üîí</div>
                    <div class="locked-title">${node.title}</div>
                    <div class="locked-desc">${node.preview}</div>
                    <button class="unlock-btn" onclick="unlockNode()" ${!canAfford ? 'disabled' : ''}>EXPLORE PATH</button>
                    <div class="unlock-cost">Cost: ${node.cost} Qi ${!canAfford ? '(insufficient)' : ''}</div>
                </div>
            `;
        }

        function updateNavButtons(node) {
            btnNorth.disabled = !node.north;
            btnEast.disabled = !node.east;
            btnSouth.disabled = !node.south;
            btnWest.disabled = !node.west;
        }

        function renderIndex() {
            const totalNodes = Object.keys(nodes).filter(k => !k.startsWith('locked:')).length;
            indexStats.textContent = `Explored: ${exploredNodes.size} / ${totalNodes}`;

            const categories = {
                core: { title: 'CORE', nodes: [] },
                cardinal: { title: 'CARDINAL', nodes: [] },
                intersection: { title: 'INTERSECTIONS', nodes: [] },
                deep: { title: 'DEEP', nodes: [] }
            };

            Object.keys(nodes).forEach(key => {
                const node = nodes[key];
                if (key.startsWith('locked:')) return;
                const cat = node.category || 'core';
                if (categories[cat]) categories[cat].nodes.push({ key, node });
            });

            let html = '';
            Object.values(categories).forEach(cat => {
                if (cat.nodes.length === 0) return;
                html += `<div class="index-category"><div class="index-category-title">${cat.title}</div>`;
                cat.nodes.forEach(({ key, node }) => {
                    const isCurrent = key === currentNode;
                    const isExplored = exploredNodes.has(key);
                    let statusClass = isExplored ? '' : 'unexplored';
                    let iconClass = isExplored ? 'explored' : 'unexplored';
                    if (isCurrent) { statusClass = 'current'; iconClass = 'current'; }

                    html += `<div class="index-node ${statusClass}" onclick="jumpToNode('${key}')">
                        <div class="index-node-icon ${iconClass}"></div>
                        <div class="index-node-name">${node.title}</div>
                    </div>`;
                });
                html += `</div>`;
            });

            indexList.innerHTML = html;
        }

        function navigate(direction) {
            if (!gameStarted) return;
            const node = nodes[currentNode];
            let target = node[direction];
            if (!target) return;

            flash.classList.add('active');
            setTimeout(() => flash.classList.remove('active'), 100);

            nodeContent.classList.add('transitioning');
            setTimeout(() => {
                pathHistory.push(target);
                currentNode = target;
                const trackKey = target.startsWith('locked:') ? target : target;
                exploredNodes.add(trackKey);
                render();
                nodeContent.classList.remove('transitioning');
            }, 200);
        }

        function goBack() {
            if (pathHistory.length <= 1) return;
            flash.classList.add('active');
            setTimeout(() => flash.classList.remove('active'), 100);

            nodeContent.classList.add('transitioning');
            setTimeout(() => {
                pathHistory.pop();
                currentNode = pathHistory[pathHistory.length - 1];
                render();
                nodeContent.classList.remove('transitioning');
            }, 200);
        }

        function jumpToNode(key) {
            if (!exploredNodes.has(key) || nodes[key].locked) return;
            if (key === currentNode) return;
            flash.classList.add('active');
            setTimeout(() => flash.classList.remove('active'), 100);

            nodeContent.classList.add('transitioning');
            setTimeout(() => {
                pathHistory.push(key);
                currentNode = key;
                render();
                nodeContent.classList.remove('transitioning');
            }, 200);
        }

        function unlockNode() {
            const node = nodes[currentNode];
            if (!node.locked || energy < node.cost) return;
            energy -= node.cost;
            const unlockedKey = node.unlocks;

            Object.keys(nodes).forEach(key => {
                const n = nodes[key];
                ['north', 'east', 'south', 'west'].forEach(dir => {
                    if (n[dir] === currentNode) n[dir] = unlockedKey;
                });
            });

            pathHistory[pathHistory.length - 1] = unlockedKey;
            currentNode = unlockedKey;
            exploredNodes.add(currentNode);
            render();
        }

        document.addEventListener('keydown', (e) => {
            if (!gameStarted && (e.key === 'Enter' || e.key === ' ')) {
                e.preventDefault();
                enterCompass();
                return;
            }
            if (!gameStarted) return;

            switch(e.key) {
                case 'ArrowUp': case 'w': case 'W': e.preventDefault(); navigate('north'); break;
                case 'ArrowRight': case 'd': case 'D': e.preventDefault(); navigate('east'); break;
                case 'ArrowDown': case 's': case 'S': e.preventDefault(); navigate('south'); break;
                case 'ArrowLeft': case 'a': case 'A': e.preventDefault(); navigate('west'); break;
                case 'Backspace': e.preventDefault(); goBack(); break;
                case ' ': case 'Enter':
                    e.preventDefault();
                    if (nodes[currentNode] && nodes[currentNode].locked) unlockNode();
                    break;
            }
        });
    </script>

</body>
</html>
